if(!window.Qt){Qt={alert:function(a){alert(a)},enableMenu:function(){},preferences:function(){wapp.dialog.show("<p style = 'text-align: center'>Fonction non implémentée</p>"),{modal:true}},error:function(a){alert(a)},message:function(a){alert(a)},log:function(a){console.log(a)},showMenu:function(){},fullscreen:function(){},isFullscreen:function(){return false},isOnline:function(){return true},getSettings:function(b,a){var c=localStorage[b];if(!c){c=false}c6k.callback(a,[c])},setSettings:function(a,b){localStorage[a]=b},onLoad:function(){},getFileName:function(b,a){console.log("getFileName non implemente.");return false},isNav:true}}QtButton={NoButton:0,Ok:1024,Save:2048,SaveAll:4096,Open:8192,Yes:16384,YesToAll:32768,No:65536,NoToAll:131072,Abort:262144,Retry:524288,Ignore:1048576,Close:2097152,Cancel:4194304,Discard:8388608,Help:16777216,Apply:33554432,Reset:67108864,RestoreDefaults:134217728};
var i18n=(function(){var b="";var a={};if(!window._T){window._T=function(c,d){return i18n.T(c,d)}}return{add:function(e){var d,c;if(typeof e=="object"){for(d in e){if(typeof e[d]=="object"){if(!a[d]){a[d]={}}for(c in e[d]){a[d][c]=e[d][c]}}}}},T:function(e,f){if(!e){return}var c=a[b];if(!c||!c[e]){for(var d in a){c=a[d];break}}if(!c||!c[e]){return e}if(!f){return c[e]}if(!(f instanceof Array)){f=[f]}return c[e].replace(/\{(\d+)\}/g,function(g,h){if(typeof f[h-1]=="undefined"){return g}return f[h-1]})},setLang:function(c){if(!c){for(c in a){break}}b=c;$("[data-i18n]").each(function(){var d=$(this);d.html(i18n.T(d.attr("data-i18n")))});return b},getLang:function(){return b}}})();
var mesAdresses={};mesAdresses.iframeShow=function(h,e,a,j,c){if(h===1){var g=e.dlg;if(e.action=="register"){wapp.dialog.show(g,{modal:true,width:400,height:435})}else{wapp.dialog.show(g,{modal:true,width:400,"class":e.classe})}var i=new WaitDialog();i.wait();i.setMessage(a);$("#retour_iframe",g).attr("src",wapp.serveur+e.action);$("#wappDialog").css("top",-1000);var b=setTimeout(function(){i.close();wapp.dialog.hide()},15000);$("#retour_iframe",g).load(function(){if($(".fos_user_user_show",$("#retour_iframe").contents()).html()){clearTimeout(b);i.close();wapp.dialog.hide();$("#wappDialog").css("top","");if(typeof j=="function"){j()}}else{clearTimeout(b);i.close();$("#wappDialog").css("top","");if(typeof c=="function"){wapp.dialog.hide();c()}}})}else{var d=e.classe;var f={"class":d};wapp.dialog.show(e.dlg,{"class":f});var i=new WaitDialog();i.wait();i.setMessage(a);$("#wappDialog").css("top",-1000);var b=setTimeout(function(){i.close();wapp.dialog.hide()},15000);$.ajax({type:"GET",url:wapp.serveur+e.action,timeout:15000,success:function(k){clearTimeout(b);i.close();wapp.dialog.hide();$("#wappDialog").css("top","");$(".contenu").html(k)},error:function(m,k,l){clearTimeout(b);i.close();$("#wappDialog").css("top","");if(typeof c=="function"){c()}else{reponse="probleme";console.log(m);console.log(k);console.log(l)}}})}};mesAdresses.retourInfo=function(){var b=_D(PATH_VIZADRESSE+"viz/modeles/formulaire");wapp.dialog.show(b,{modal:true,width:400});var a={dlg:b,action:"formulaire",classe:"form_bug"};mesAdresses.iframeShow(1,a,"Merci de patienter...",function(){})};mesAdresses.sansAccent=function(c){var a=[/[\300-\306]/g,/[\340-\346]/g,/[\310-\313]/g,/[\350-\353]/g,/[\314-\317]/g,/[\354-\357]/g,/[\322-\330]/g,/[\362-\370]/g,/[\331-\334]/g,/[\371-\374]/g,/[\321]/g,/[\361]/g,/[\307]/g,/[\347]/g,];var d=["A","a","E","e","I","i","O","o","U","u","N","n","C","c"];for(var b=0;b<a.length;b++){c=c.replace(a[b],d[b])}return c};mesAdresses.lireCookie=function(b){var e=b+"=";var a=document.cookie.split(";");for(var d=0;d<a.length;d++){var f=a[d];while(f.charAt(0)==" "){f=f.substring(1,f.length)}if(f.indexOf(e)==0){return f.substring(e.length,f.length)}}return null};mesAdresses.creerCookie=function(d,a,c){if(window.localStorage!==undefined){window.localStorage[d]=true}else{var e=new Date();e.setTime(e.getTime()+(c*24*60*60*1000));var b="; expires="+e.toGMTString();document.cookie=d+"="+a+b+"; path=/"}};mesAdresses.afficheBandeauCookies=function(a){if((window.localStorage!==undefined&&!window.localStorage[a])||(window.localStorage==undefined&&mesAdresses.lireCookie(a)==null)){$("#bCookies input").click(function(){mesAdresses.creerCookie(a,"true",365);$("#bCookies").hide()});$("#bCookies").show()}};mesAdresses.getServeur=function(){var b=document.URL;var c=["app_dev.php","app.php","vizadresse",".ign.fr"];for(var a=0;a<c.length;a++){var d=b.search(c[a]);if(d>=0){b=b.substr(0,d)+c[a]+"/";break}}return b};mesAdresses.changeSelec=function(a){if($(a).hasClass("selection")){$(a).removeClass("selection");$(a+" i").removeClass("selection")}else{$(a).addClass("selection");$(a+" i").addClass("selection")}};mesAdresses.getClef=function(a,b){$.ajax(wapp.serveur+"getClef",{type:"GET",success:function(c){if(c=="noKey"){if(Qt.isNav&&a){apiKey="v625fjanypywtame8ro0e8dl"}else{if(a){apiKey="3sz3yoe6nnvsi62hpdq0p9of"}}if(b){b(c)}}else{if(a){apiKey=c}if(b){b(c)}}},error:function(e,c,d){if(Qt.isNav&&a){apiKey="v625fjanypywtame8ro0e8dl"}else{if(a){apiKey="3sz3yoe6nnvsi62hpdq0p9of"}}if(b){b(e)}}})};mesAdresses.majClef=function(a){$.ajax(wapp.serveur+"setClef",{type:"POST",data:{clef:a},success:function(b){if(b=="deco"){alert("Echec. Votre connexion a expirée.");return}alert("La clef a bien été enregistrée.");apiKey=a},error:function(d,b,c){}})};mesAdresses.changeClef=function(c){if(c){mesAdresses.majClef("");return}var b=$("#input_clef").val();if(!b.length){return}var e="73 avenue de Paris, 94160 SAINT-MANDE";var a={};a.adresse=true;a.max=25;a.poi=false;wapp.geocodeur=new GeoportailService(b);var d=function(f,i,g,h){if(!f){if(h.match("Wrong User-Agent")){mesAdresses.majClef(b)}else{h=h.replace(/<[^<>]*>/g,"");if(!confirm("Erreur "+g+". "+h+"\n \n Il semble que votre clef ne soit pas valide, voulez-vous quand même l'enregistrer ?")){return}else{mesAdresses.majClef(b)}}}else{if(f.place){mesAdresses.majClef(b)}else{if(!confirm("Votre clef est valide mais ne semble pas avoir les droits pour géocoder. \n Voulez-vous quand même l'enregistrer ?")){return}else{mesAdresses.majClef(b)}}}};wapp.geocodeur.geocode(e,d,a)};
var Authentication=function(){var b=false;var a="";this.getUserId=function(){return a};this.setAuthenticatedToFalse=function(){b=false};this.setAuthenticated=function(){$.ajax(wapp.serveur+"getUserId",{type:"GET",timeout:5000,success:function(c){if(c=="0"||c==0){b=false;$(".btclef").hide();if(Qt.isNav){apiKey="v625fjanypywtame8ro0e8dl"}else{apiKey="3sz3yoe6nnvsi62hpdq0p9of"}}else{b=true;if(!Qt.isNav){$(".btclef").show();mesAdresses.getClef(true)}}},error:function(e,c,d){b=false}})};this.getAuthenticated=function(){if(b){$("#user_account").addClass("connected")}else{$("#user_account").removeClass("connected")}return b};this.newAccount=function(f,c){self=this;var e=_D(PATH_VIZADRESSE+"viz/modeles/newAccount");var d={dlg:e,action:"register"};mesAdresses.iframeShow(1,d,"Merci de patienter...",function(){})};this.authenticate=function(h,d){var e=this;var g=_D(PATH_VIZADRESSE+"viz/modeles/authenticate");wapp.dialog.show(g,{modal:true,width:400});var c=new WaitDialog();c.wait();c.setMessage("Connexion en cours...");$("#retour_iframe",g).attr("src",wapp.serveur+"profile");$("#newAccount").click(function(){e.newAccount()});$("#wappDialog").css("top",-1000);var f=setTimeout(function(){c.close();wapp.dialog.hide()},15000);$("#retour_iframe").load(function(){if($(".fos_user_user_show",$("#retour_iframe").contents()).html()){clearTimeout(f);b=true;if(!Qt.isNav){$(".btclef").show()}$("#user_account").addClass("connected");$.ajax(wapp.serveur+"lastLogApp",{type:"POST",data:{isNav:Qt.isNav},success:function(){},error:function(k,i,j){}});$.ajax(wapp.serveur+"getName",{type:"GET",timeout:15000,success:function(i){$("#affiche_compte a").html(i)}});if(!Qt.isNav){mesAdresses.getClef(true,function(i){c.close();wapp.dialog.hide();$("#wappDialog").css("top","");if(typeof h=="function"){h()}})}c.close();wapp.dialog.hide();$("#wappDialog").css("top","")}else{clearTimeout(f);b=false;$(".btclef").hide();$("#user_account").removeClass("connected");if(Qt.isNav){apiKey="v625fjanypywtame8ro0e8dl"}else{apiKey="3sz3yoe6nnvsi62hpdq0p9of"}c.close();$("#wappDialog").css("top","");if(typeof d=="function"){wapp.dialog.hide();d()}}})};this.deauthenticate=function(){var c="Souhaitez-vous vraiment vous déconnecter? ";this.msgChoice(c,function(){b=false;if(Qt.isNav){apiKey="v625fjanypywtame8ro0e8dl"}else{apiKey="3sz3yoe6nnvsi62hpdq0p9of"}$(".btclef").hide();$("#user_account").removeClass("connected");$("#wappDialog").css("top",-1000);var e=_D(PATH_VIZADRESSE+"viz/modeles/authenticate");var d={dlg:e,action:"logout"};mesAdresses.iframeShow(1,d,"Déconnexion...",function(){},function(){if($("#container")){wapp.dialog.hide();$("#wappDialog").css("top","")}})},function(){wapp.dialog.hide()})};this.msgChoice=function(e,c,d){wapp.dialog.show(_D(PATH_VIZADRESSE+"viz/modeles/YesNo"),{modal:true});$("#msg").html(e);$("#doSuppr").click(c);$("#dontSuppr").click(d)}};
var wapp=(function(){function a(){var b=$("<div>").addClass("messageBox animation-zoom zoom-in").css({display:"block",top:-1000}).appendTo("body");wapp.initialize()}$(document).ready(a);return{}})();wapp.initialize=function(){wapp.serveur=mesAdresses.getServeur();mesAdresses.afficheBandeauCookies("cookies_01");$(function(){$("#rentrer_maison").attr("href",wapp.serveur);$("#ign-all").mouseover(function(){$(".dropdown-menu").show()});$("#ign-all").mouseout(function(){$(".dropdown-menu").hide()});$("#ign-all .dropdown-menu").mouseover(function(){$(".dropdown-menu").show()});$("#ign-all .dropdown-menu").mouseout(function(){$(".dropdown-menu").hide()});$(".nous_ecrire").click(mesAdresses.retourInfo);$("#connec_compte").click(function(){wapp.authentification.authenticate()});$("#mon_compte i").click(function(){wapp.authentification.authenticate()});$("#deconnec_compte").click(function(){wapp.authentification.deauthenticate()});$("#crea_compte").click(function(){wapp.authentification.newAccount()});$("#affiche_compte a").attr("href",wapp.serveur+"utilisateur");$("#unco_img").attr("href",wapp.serveur+"utilisateur")});wapp.authentification=new Authentication()};
function _D(a){if(typeof(a)!="string"){return""}var c="";if(!wapp.dialog.modeles[a]){var b=a;if(a.indexOf("/")<0){b="viz/modeles/"+a}wapp.dialog.modeles[a]=$.ajax({type:"GET",url:b+".html",async:false}).responseText}c=$(wapp.dialog.modeles[a]);if(window.i18n){$("[data-i18n]",c).each(function(){var d=$(this);d.html(i18n.T(d.attr("data-i18n")))})}return c}var WaitDialog=function(o){if(!$("#wait").length){var e=$("<div>").attr("id","progressBar").append($("<div>").addClass("pourcentage")).append($("<div>").addClass("text")).append($("<div>").addClass("text textop"));var g=$("<div>").addClass("messageBox animation-zoom").append($("<div>").addClass("inner").html(_T("loading"))).append(e).append($("<div>").addClass("timer"));$("<div>").attr("id","wait").append($("<div>").addClass("modal_background").hide()).append(g).appendTo($("body"))}var d=$("#wait");var l=$("#wait .messageBox");var m=$("#wait .inner");var h=$("#wait .text");var i=$("#wait .textop");var n=$("#wait .pourcentage");var l=$("#wait .messageBox");var a=$("#wait .timer");var j=$("#wait .modal_background");if(!o){o={}}var c=o.timer;var b=new Date().getTime();var k=o.modal;var f=function(p){var r=Math.floor(p/1000);var u=Math.floor(r/60);var q=Math.floor(u/60);r=r-u*60;u=u-q*60;return(q<10?"0":"")+q+":"+(u<10?"0":"")+u+":"+(r<10?"0":"")+r};this.setMessage=function(p){m.html(p)};this.setTimer=function(p){c=(p!==false);this.wait("",l.hasClass("progress")?Number(i.text().replace("%","")):false)};this.resetTimer=function(){c=true;b=new Date().getTime();this.wait("",l.hasClass("progress")?Number(i.text().replace("%","")):false)};this.setModal=function(p){k=(p!==false);this.wait("",l.hasClass("progress")?Number(i.text().replace("%","")):false)};this.close=function(){this.wait(false)};this.wait=function(q,r){if(typeof(q)=="number"){r=q;q=""}if(k){j.show()}else{j.hide()}if(q!==false){d.show();l.zoomIn();if(r||r===0){if(q){m.html(q)}l.addClass("progress");n.css("width",r+"%");h.text((r>0?Math.round(r-0.5):0)+"%");i.css("clip","rect(0px, "+$("#progressBar .pourcentage").width()+"px, 20px, 0px)")}else{m.html(q?q:_T("loading"));l.removeClass("progress")}if(c){var p=new Date().getTime()-b;if(r&&r<100){p=_T("time")+f(p)+(r?" - "+_T("remain_time")+f(p*100/r-p):"")}else{p=_T("time")+f(p)}a.html(p).show()}else{a.hide()}}else{j.hide();l.zoomOut()}}};$.fn.extend({zoomIn:function(){return this.each(function(){$(this).addClass("animation-zoom").addClass("zoom-in");$(this).show()})},zoomOut:function(){return this.each(function(){var a=$(this);$(this).addClass("animation-zoom").removeClass("zoom-in");$(this).show();setTimeout(function(){a.hide()},500)})},toggleZoom:function(){return this.each(function(){if($(this).hasClass("zoom-in")){$(this).zoomOut()}else{$(this).zoomIn()}})}});wapp.dialog=(function(){var d=[];var c;var a;var f=function(h,g){if(typeof(g)!="object"){g={}}if(!d.length){d=$("<div>").attr("id","modal_background").addClass("modal_background").css({position:"fixed",top:0,left:0,bottom:0,right:0,"z-index":1999,display:"none"}).appendTo("body");c=$("<div>").attr("id","wappDialog").appendTo("body")}c.removeClass().addClass("messageBox");if(g["class"]){c.addClass(g["class"])}if(g.width){c.width(g.width)}else{c.width("")}c.css("margin-left",-c.outerWidth()/2+"px");g.animate=(g.animate!==false);if(g.animate){c.addClass("animation-zoom")}if(g.disableMenu!==false&&g.disableMenu!==true){g.disableMenu=g.modal}a=g;var i;if(typeof(h)!="object"||!h.jquery){i=$("<div>"+h+"</div>")}else{i=h}a.content=$("<div>").addClass("inner");if(g.closeBox!==false){$("<i class='fa fa-close wappCloseBox'>").click(function(){wapp.dialog.close()}).appendTo(a.content)}a.content.append(i)};var b=function(){if(a.modal){d.show()}if(!window.Qt){if(a.disableMenu){Qt.enableMenu(false)}}c.html("").append(a.content);if(a.animate){setTimeout(function(){c.zoomIn()},200)}else{c.show()}};var e=function(g){if(!d.length){return}d.hide();if(!window.Qt){if(a.disableMenu){Qt.enableMenu(true)}}if(a.animate&&!g){c.zoomOut()}else{c.removeClass("animation-zoom zoom-in").hide()}};return{show:function(h,g){f(h,g);b()},hide:function(){e(true)},close:function(){e()},setAnimation:function(g){a.animate=(g!==false)},modeles:{}}})();wapp.dialog.selectAdresse=function(a){var b,g;var e=new Array();for(var d=0;d<a.length;d++){g=a[d];b=(g.adresse.num?g.adresse.num+" ":"")+(g.adresse.rue?g.adresse.rue+" ":"")+(g.adresse.cpost?g.adresse.cpost+" ":"")+g.place.commune+"("+g.place.departement+")";var f=14;switch(g.match.type){case"Street number":f=17;break;case"Street":f=16;break;case"City":default:f=14;break}if(a.length==1){wapp.map.setCenterAtLonlat([g.lon,g.lat],f);return true}if(g.bbox[0]==g.bbox[2]){b="<li><a href='javascript:wapp.map.setCenterAtLonlat(["+g.lon+","+g.lat+"],"+f+")'>"+b+"</a></li>"}else{b="<li><a href='javascript:wapp.map.setCenterAtLonlat(["+g.bbox[0]+","+g.bbox[1]+","+g.bbox[2]+","+g.bbox[3]+"],"+f+")'>"+b+"</a></li>"}e.push(b)}var c=$("<ul>").html(e);wapp.dialog.show(c,{"class":"selectAdresse"})};